<script>
    // onFailure : Error -> n/a
    // failure handler for async server calls, adds dismissable error alert to top of page
    function onFailure(error) {
        var html = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Error!</strong> ` + error.message + `
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>`;
        $(".error-box").html(html);
    }

    // onSuccessHTML : HTML Object[HTML] -> n/a
    // success handler for async server calls, inserts returned payload into provided element's HTML
    function onSuccessHTML(htmlPayload, htmlObject) {
        htmlObject.html(htmlPayload);
    }

    var runnerHTML = google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccessHTML);

    /* General website functions */

    // load page elements via async
    $(function () {
        // load placeholder content
        runnerHTML.withUserObject($("#wp-content")).getPlaceholderHTML("Enter WBS # Above");
        runnerHTML.withUserObject($("#gantt-content")).getPlaceholderHTML("* Coming Soon * <br> Enter WBS # Above");
        runnerHTML.withUserObject($("#change-content")).getPlaceholderHTML("* Coming Soon * <br> Choose Change Type Above");
        runnerHTML.withUserObject($("#report-content")).getPlaceholderHTML("* Coming Soon * <br> Choose Report Type Above");
    });

    // once page loaded
    $(window).on("load", function () {
        setTimeout(function () {
            $(".loader-wrapper").fadeOut("slow");
        }, 500);
    });

    /* Gantt page functions */

    // click Go button on Gantt page
    $("#gantt-go-btn").on("click", function () {
        var gantt_input = $("#gantt-go-input").val();
        var gantt_content = $("#gantt-content");
        alert("Gantt go button clicked, WBS # " + gantt_input);
    });

    // click Go button on WP Lookup page
    $("#wp-go-btn").on("click", function () {
        var wp_input = $("#wp-go-input").val();
        var wp_content = $("#wp-content");
        runnerHTML.withUserObject(wp_content).getWorkPackage(wp_input);
    });

    // click Go button on Changes page for change type
    $("#change-type-go-btn").on("click", function () {
        var change_type = $("#change-type-go-input").val();
        var change_content = $("#change-content");
        runnerHTML.withUserObject(change_content).getChangeForm(change_type);
        // alert("Change type go button clicked, type: " + change_type);
        // wait for click on frame before attaching click listener to button
        if (change_type == "status") {
            change_content.on("click", function () {
                $("#status-go-btn").on("click", function () {
                    var status_lookup_input = $("#status-go-input").val();
                    var status_content = $("#status-content");
                    runnerHTML.withUserObject(status_content).getStatusUpdateContent(status_lookup_input);
                    status_content.on("click", function () {
                        $("#new-status-go-btn").on("click", function () {
                            var new_status_input = $("#new-status-go-input").val();
                            var newStatusObj = {
                                wbs: status_lookup_input,
                                status: new_status_input,
                            };
                            var message_box = $(".error-box");
                            runnerHTML.withUserObject(message_box).setNewStatus(newStatusObj);
                        });
                    });
                });
            });
        }
    });

    // click Go button on Reports page
    $("#report-type-go-btn").on("click", function () {
        var report_type = $("#report-type-go-input").val();
        var report_content = $("#report-content");
        alert("Report type go button clicked, type: " + report_type);
    });
</script>